<!-- accessible-modal.html -->
<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Accessible Modal</title>
    <style>
        .backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .5);
            display: flex;
            align-items: center;
            justify-content: center
        }

        .modal {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px
        }

        .hidden {
            display: none
        }
    </style>
</head>

<body>
    <button id="open">Open Modal</button>

    <div id="back" class="hidden" role="dialog" aria-modal="true" aria-labelledby="title">
        <div class="modal">
            <h2 id="title">Modal Title</h2>
            <p>Some content. Press ESC to close.</p>
            <button id="close">Close</button>
        </div>
    </div>

    <script>
        const open = document.getElementById('open');
        const back = document.getElementById('back');
        const close = document.getElementById('close');

        let lastFocused = null;

        function trapFocus(e) {
            const focusable = back.querySelectorAll('button, [href], input, textarea, select, [tabindex]:not([tabindex="-1"])');
            const first = focusable[0];
            const last = focusable[focusable.length - 1];
            if (e.key === 'Tab') {
                if (e.shiftKey && document.activeElement === first) {
                    e.preventDefault();
                    last.focus();
                } else if (!e.shiftKey && document.activeElement === last) {
                    e.preventDefault();
                    first.focus();
                }
            } else if (e.key === 'Escape') {
                closeModal();
            }
        }

        function openModal() {
            lastFocused = document.activeElement;
            back.classList.remove('hidden');
            const focusable = back.querySelectorAll('button, [href], input, textarea, select, [tabindex]:not([tabindex="-1"])');
            if (focusable.length) focusable[0].focus();
            document.addEventListener('keydown', trapFocus);
        }

        function closeModal() {
            back.classList.add('hidden');
            if (lastFocused) lastFocused.focus();
            document.removeEventListener('keydown', trapFocus);
        }

        open.addEventListener('click', openModal);
        close.addEventListener('click', closeModal);
        back.addEventListener('click', (e) => {
            if (e.target === back) closeModal(); // click outside to close
        });
    </script>
</body>

</html>